<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔥 Terabox Ultra | Made in India 🇮🇳</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --dark-bg: #0a0a0a;
            --card-bg: #1a1a1a;
            --premium-gold: #ffd700;
        }

        body {
            background: var(--dark-bg);
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }

        .neon-text {
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue),
                         0 0 20px var(--neon-blue),
                         0 0 30px var(--neon-blue);
        }

        .neon-border {
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue),
                       0 0 20px rgba(0, 243, 255, 0.3);
        }

        .tg-btn {
            background: #0088cc;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .tg-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #0088cc;
        }

        .download-btn {
            background: linear-gradient(45deg, #6a00ff, #00ff88);
            border: none;
            font-weight: bold;
            transition: all 0.3s;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(106, 0, 255, 0.4);
        }

        .progress-bar {
            background: linear-gradient(90deg, #00ff00, #00ff88);
            height: 100%;
            border-radius: 5px;
        }

        .admin-panel {
            background: rgba(0,0,0,0.9);
            border: 3px solid var(--neon-pink);
            border-radius: 20px;
            padding: 2rem;
        }

        .username-input {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--neon-blue);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand neon-text" href="#">
                <i class="fas fa-bolt me-2"></i>TERABOX ULTRA
            </a>
            <button class="btn btn-outline-info" onclick="showAdminPanel()">
                <i class="fas fa-user-shield"></i> Admin
            </button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container my-5">
        <!-- Username Section -->
        <div class="row justify-content-center mb-4">
            <div class="col-lg-8">
                <div class="card bg-dark neon-border p-3">
                    <div class="input-group">
                        <input type="text" id="username" class="form-control username-input" 
                               placeholder="Choose your username...">
                        <button class="btn btn-primary" onclick="saveUsername()">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Download Section -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card bg-dark neon-border p-4 mb-4">
                    <h3 class="text-center mb-4 neon-text">TERABOX VIDEO DOWNLOADER</h3>
                    <div class="input-group mb-3">
                        <input type="text" id="teraboxUrl" class="form-control bg-dark text-white" 
                               placeholder="Paste Terabox link here...">
                        <button class="btn btn-primary download-btn" onclick="processLink()">
                            <i class="fas fa-download me-2"></i>DOWNLOAD
                        </button>
                    </div>
                    <div id="userStatus" class="mt-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Daily Downloads:</span>
                            <span id="downloadCount">0/10</span>
                        </div>
                        <div class="progress bg-secondary" style="height: 10px;">
                            <div id="downloadProgress" class="progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Result Section -->
                <div id="resultSection" class="card bg-dark neon-border p-4" style="display: none;">
                    <!-- Results will be shown here -->
                </div>
            </div>
        </div>

        <!-- Subscription Button -->
        <div class="row mt-4 justify-content-center">
            <div class="col-lg-8 text-center">
                <a href="https://t.me/DarksideXwebs" class="tg-btn" target="_blank">
                    <i class="fas fa-crown me-2"></i>BUY PREMIUM SUBSCRIPTION
                </a>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="container mt-5 admin-panel" style="display: none;">
        <h3 class="text-center neon-text mb-4">👑 ADMIN CONTROL PANEL</h3>
        
        <div class="row">
            <div class="col-md-6">
                <h5>User Management</h5>
                <div class="mb-3">
                    <label>Username</label>
                    <input type="text" id="adminUsername" class="form-control bg-dark text-white">
                </div>
                <div class="mb-3">
                    <label>Daily Limit</label>
                    <input type="number" id="dailyLimit" class="form-control bg-dark text-white" value="10">
                </div>
                <div class="mb-3">
                    <label>Premium Status</label>
                    <select id="premiumStatus" class="form-control bg-dark text-white">
                        <option value="false">Regular User</option>
                        <option value="true">Premium User</option>
                    </select>
                </div>
                <button class="btn btn-success w-100" onclick="updateUser()">Update User</button>
            </div>
            
            <div class="col-md-6">
                <h5>API Management</h5>
                <div class="mb-3">
                    <label>API Endpoints (comma separated)</label>
                    <textarea id="apiEndpoints" class="form-control bg-dark text-white" rows="3">https://terabox-player.rishuapi.workers.dev/,https://terabox-dl.example.com/</textarea>
                </div>
                <button class="btn btn-info w-100 mb-2" onclick="testApis()">Test APIs</button>
                <div id="apiTestResults" class="text-center"></div>
            </div>
        </div>
        
        <div class="mt-4">
            <h5>Statistics</h5>
            <div class="row">
                <div class="col-md-4">
                    <div class="card bg-dark mb-3">
                        <div class="card-body">
                            <h6>Total Downloads</h6>
                            <h3 id="totalDownloads">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-dark mb-3">
                        <div class="card-body">
                            <h6>API Requests</h6>
                            <h3 id="totalRequests">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-dark mb-3">
                        <div class="card-body">
                            <h6>Active Users</h6>
                            <h3 id="activeUsers">0</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Made in India Badge -->
    <div class="position-fixed bottom-0 end-0 m-3">
        <img src="https://flagcdn.com/w80/in.png" height="60" alt="Made in India">
    </div>

    <!-- Footer -->
    <footer class="text-center py-3">
        <p class="mb-1">MADE BY RUDRA </p>
        <p class="mb-0">MADE BY RUDRA</p>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global Variables
        const ADMIN_KEY = "RUDRAPAWAR";
        let currentApiIndex = 0;
        let apis = ["https://terabox-player.rishuapi.workers.dev/"];
        let stats = {
            downloads: 0,
            requests: 0,
            users: 0
        };
        let users = {};
        let currentUsername = "";

        // Initialize App
        function init() {
            loadStats();
            loadUsers();
            loadCurrentUser();
            
            // Load multiple APIs if available
            const savedApis = localStorage.getItem('teraboxApis');
            if(savedApis) {
                apis = JSON.parse(savedApis);
                document.getElementById('apiEndpoints').value = apis.join(",");
            }
        }

        // User Functions
        function saveUsername() {
            const username = document.getElementById('username').value.trim();
            if(username) {
                currentUsername = username;
                localStorage.setItem('teraboxUsername', username);
                
                if(!users[username]) {
                    users[username] = {
                        downloads: 0,
                        limit: 10,
                        isPremium: false,
                        lastDownload: null
                    };
                    stats.users++;
                    saveUsers();
                    saveStats();
                }
                
                alert("Username saved successfully!");
                updateUserDisplay();
            } else {
                alert("Please enter a valid username");
            }
        }

        function loadCurrentUser() {
            const savedUsername = localStorage.getItem('teraboxUsername');
            if(savedUsername) {
                currentUsername = savedUsername;
                document.getElementById('username').value = savedUsername;
                updateUserDisplay();
            }
        }

        function updateUserDisplay() {
            if(currentUsername && users[currentUsername]) {
                const user = users[currentUsername];
                const today = new Date().toDateString();
                const lastDownload = user.lastDownload ? new Date(user.lastDownload).toDateString() : null;
                const usedDownloads = lastDownload === today ? user.downloads : 0;
                
                document.getElementById('downloadCount').textContent = 
                    `${usedDownloads}/${user.limit}${user.isPremium ? ' (Premium)' : ''}`;
                document.getElementById('downloadProgress').style.width = 
                    `${Math.min(100, (usedDownloads / user.limit) * 100)}%`;
            }
        }

        // Admin Functions
        function showAdminPanel() {
            const key = prompt("Enter Admin Key:");
            if(key === ADMIN_KEY) {
                document.getElementById('adminPanel').style.display = 'block';
                updateAdminDisplay();
            } else {
                alert("Invalid admin key!");
            }
        }

        function updateUser() {
            const username = document.getElementById('adminUsername').value;
            const limit = parseInt(document.getElementById('dailyLimit').value);
            const isPremium = document.getElementById('premiumStatus').value === 'true';
            
            if(username && users[username]) {
                users[username].limit = limit;
                users[username].isPremium = isPremium;
                saveUsers();
                alert("User updated successfully!");
                
                if(username === currentUsername) {
                    updateUserDisplay();
                }
            } else {
                alert("User not found!");
            }
        }

        function testApis() {
            const apiList = document.getElementById('apiEndpoints').value.split(',').map(api => api.trim());
            const resultsDiv = document.getElementById('apiTestResults');
            resultsDiv.innerHTML = "<p>Testing APIs... Please wait</p>";
            
            // Simple test - we'll just check if the URL looks valid
            setTimeout(() => {
                let resultHTML = "";
                apiList.forEach(api => {
                    const isValid = api.startsWith('http') && api.includes('terabox');
                    resultHTML += `<p class="${isValid ? 'text-success' : 'text-danger'}">
                        ${api} - ${isValid ? '✅ Working' : '❌ Not Valid'}
                    </p>`;
                });
                
                resultsDiv.innerHTML = resultHTML;
                if(apiList.length > 0) {
                    apis = apiList.filter(api => api.startsWith('http') && api.includes('terabox'));
                    localStorage.setItem('teraboxApis', JSON.stringify(apis));
                }
            }, 1000);
        }

        // Download Functions
        function processLink() {
            if(!currentUsername) {
                alert("Please set a username first!");
                return;
            }
            
            const user = users[currentUsername];
            const today = new Date().toDateString();
            const lastDownload = user.lastDownload ? new Date(user.lastDownload).toDateString() : null;
            
            // Check download limit
            if(!user.isPremium && lastDownload === today && user.downloads >= user.limit) {
                alert(`Daily download limit reached! ${user.limit} downloads per day for free users.`);
                return;
            }
            
            const url = document.getElementById('teraboxUrl').value.trim();
            if(!url.includes('terabox')) {
                alert("Please enter a valid Terabox URL");
                return;
            }
            
            // Update download count
            if(lastDownload === today) {
                user.downloads++;
            } else {
                user.downloads = 1;
            }
            user.lastDownload = new Date().toISOString();
            
            stats.downloads++;
            stats.requests++;
            
            saveUsers();
            saveStats();
            updateUserDisplay();
            updateAdminDisplay();
            
            // Process download with current API
            processDownload(url);
        }

        function processDownload(url) {
            const api = apis[currentApiIndex];
            const apiUrl = `${api}?url=${encodeURIComponent(url)}`;
            
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if(data.error) {
                        throw new Error(data.error);
                    }
                    showResults(data);
                })
                .catch(error => {
                    console.error(`API ${api} failed:`, error);
                    // Try next API
                    currentApiIndex = (currentApiIndex + 1) % apis.length;
                    if(currentApiIndex === 0) {
                        alert("All APIs failed. Please try again later.");
                    } else {
                        processDownload(url);
                    }
                });
        }

        function showResults(data) {
            const resultSection = document.getElementById('resultSection');
            resultSection.style.display = 'block';
            resultSection.innerHTML = `
                <h4 class="neon-text mb-3">${data.title || 'Terabox File'}</h4>
                <p class="mb-3">Size: ${data.size || 'N/A'}</p>
                
                <div class="ratio ratio-16x9 mb-4">
                    <video controls class="bg-black">
                        <source src="${data.video_url}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                
                <div class="d-grid gap-2">
                    <a href="${data.download_url}" class="btn download-btn" download>
                        <i class="fas fa-download me-2"></i>Download Now
                    </a>
                </div>
            `;
            
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Data Management
        function loadStats() {
            const savedStats = localStorage.getItem('teraboxStats');
            if(savedStats) {
                stats = JSON.parse(savedStats);
                updateAdminDisplay();
            }
        }

        function saveStats() {
            localStorage.setItem('teraboxStats', JSON.stringify(stats));
        }

        function loadUsers() {
            const savedUsers = localStorage.getItem('teraboxUsers');
            if(savedUsers) {
                users = JSON.parse(savedUsers);
            }
        }

        function saveUsers() {
            localStorage.setItem('teraboxUsers', JSON.stringify(users));
        }

        function updateAdminDisplay() {
            document.getElementById('totalDownloads').textContent = stats.downloads;
            document.getElementById('totalRequests').textContent = stats.requests;
            document.getElementById('activeUsers').textContent = stats.users;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>